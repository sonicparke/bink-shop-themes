{% assign locksmith_active = false %}{% if shop.metafields.locksmith.active %} {% if product %} {% if product.metafields.locksmith.active %} {% assign locksmith_active = true %} {% else %} {% assign collection_saved = collection %} {% for collection in product.collections %} {% if collection.metafields.locksmith.active and collection.metafields.locksmith.active_for_children %} {% endif %} {% endfor %} {% assign collection = collection_saved %} {% endif %} {% elsif page and page.metafields.locksmith.active %} {% assign locksmith_active = true %} {% elsif collection and collection.metafields.locksmith.active %} {% assign locksmith_active = true %} {% endif %} {% endif %}{% if locksmith_active %} {% assign locksmith_access_granted = false %}{% unless locksmith_access_granted %} {% if customer %} {% assign locksmith_access_granted = true %} {% endif %} {% endunless %}{% if locksmith_access_granted %} {% endif %}{% if locksmith_access_granted and product %} {% assign collection_saved = collection %} {% for collection in product.collections %} {% if collection.metafields.locksmith.active and collection.metafields.locksmith.active_for_children %} {% endif %} {% endfor %} {% assign collection = collection_saved %} {% endif %}{% if locksmith_access_granted %} {{ content_for_layout }} {% else %} {% if customer %} <p><strong>This content is protected, but it doesn't look like you have access.</strong> If you feel this is a mistake, please contact the store owner.</p> {% else %} {% if shop.customer_accounts_enabled %} {% endif %}<p><strong>This content is protected</strong> - please log in with your customer account to continue.</p>{% if shop.customer_accounts_enabled %} {% layout settings.customer_layout %} <div id="customer-login"> <div class="row"> <div id="login" class="span7"> <h2 class="title">Login</h2>{% form 'customer_login' %} {{ form.errors | default_errors }}<label for="customer_email" class="label">Email Address</label> <input type="email" value="" name="customer[email]" id="customer_email" class="text" />{% if form.password_needed %} <label for="customer_password" class="label">Password</label> <input type="password" value="" name="customer[password]" id="customer_password" class="text" size="16" /> <a href="#" onclick="showRecoverPasswordForm();return false;">Forgot your password?</a> {% endif %}<div class="action_bottom"> <input class="btn" type="submit" value="Sign In" /> <span class="note">or <a href="{{ shop.url }}">Return to Store</a></span> </div> <input type="hidden" id="login_checkout_url" name="checkout_url" value="" />{% endform %} </div> <div id="recover-password" style="display:none;" class="span7"> <h2>Reset Password</h2> <p class="note">We will send you an email to reset your password.</p>{% form 'recover_customer_password' %} {{ form.errors | default_errors }}<label for="email" class="label">Email Address</label> <input type="email" value="" size="30" name="email" id="recover-email" class="text" /><input class="btn" type="submit" value="Submit" /> <span class="note">or <a href="#" onclick="hideRecoverPasswordForm();return false;">Cancel</a></span> <input type="hidden" id="login_checkout_url" name="checkout_url" value="" />{% endform %} </div> {% if shop.checkout.guest_login %} <div id="guest" class="span5"> <h2>Guest Login</h2> {% form 'guest_login' %} <input class="btn" type="submit" value="Continue as Guest" /> <input type="hidden" id="login_checkout_url" name="checkout_url" value="" />{% endform %} </div> {% endif %} </div> </div><script type="text/javascript"> function showRecoverPasswordForm() { document.getElementById('recover-password').style.display = 'block'; document.getElementById('login').style.display='none'; }function hideRecoverPasswordForm() { document.getElementById('recover-password').style.display = 'none'; document.getElementById('login').style.display = 'block'; }if (window.location.hash == '#recover') { showRecoverPasswordForm() } </script><script type="text/javascript"> window.document.title = ''; document.getElementById('login_checkout_url').value = window.location.pathname; </script> {% endif %} {% endif %} {% endif %} {% else %} {{ content_for_layout }} {% endif %}